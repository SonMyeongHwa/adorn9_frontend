<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="myPage.css" />

		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css"
		/>
		<script src="./myPage.js" defer></script>
		<title>마이페이지</title>
	</head>
	<body>
		<nav>
			<div class="nav-wrap">
				<ul class="categories-wrap">
					<a href=""> <li>Necklace</li> </a
					><a href=""> <li>Earrings</li> </a
					><a href=""> <li>Bracelet</li> </a
					><a href=""> <li>Ring</li> </a
					><a href="">
						<li>Sunglasses</li>
					</a>
				</ul>
				<a class="logo-wrap" href="">
					<img src="../assets/imgs/logo/ADORN9_LOGO.png" alt="" />
				</a>
				<ul class="utils">
					<li
						class="login"
						onclick="location.href='/client/src/login/login.html'"
					>
						로그인
					</li>
					<li
						class="my-page"
						onclick="location.href='/client/src/myPage/myPage.html'"
					>
						마이페이지
					</li>
					<li class="cart" onclick="location.href='/client/src/cart/cart.html'">
						장바구니
					</li>
				</ul>
			</div>
		</nav>
		<div class="my-page-wrap">
			<header>
				<div class="user-desc">
					<span>님</span>
					<p>다시 만나 반가워요</p>
				</div>
			</header>

			<div class="my-page-main">
				<aside>
					<h2>마이페이지</h2>
					<ul>
						<a href="">
							<li>구매내역</li>
						</a>
						<a href="../cart/cart.html">
							<li>장바구니</li>
						</a>
						<a href="../userInfo/userInfo.html">
							<li>내 정보</li>
						</a>
						<a href="">
							<li onclick="">로그아웃</li>
						</a>
					</ul>
				</aside>
				<section class="payment-details">
					<h3>구매내역</h3>
					<div class="payment-item">
						<p>배송상태</p>
						<div class="payment-product">
							<div class="product-details">
								<img
									src="/client//src/assets/imgs/귀걸이/_00e48719-eba8-419a-8ddb-08e52d0b9908.jpeg"
									alt=""
								/>
								<div class="product-desc">
									<p class="product-title">상품명</p>
									<p class="product-price">금액</p>
								</div>
							</div>
							<p class="payment-date">날짜</p>
						</div>
						<div class="payment-button">
							<button
								class="edit-order"
								onclick="location.href='/client/src/orderEdit/orderEdit.html'"
							>
								주문 수정
							</button>
							<button class="delete-order">주문 삭제</button>
						</div>
					</div>
				</section>
			</div>
		</div>
	</body>
	<script>
		const token = localStorage.getItem('TOKEN');
		const loginCheck = () => {
			if (!token) {
				console.log('사용자는 로그아웃 상태입니다.');
				// console.log(token);
				document.querySelector('.my-page').onclick = function () {
					alert('회원 전용 페이지입니다');
					window.location.href = '../main/main.html';
				};
			}
			if (token) {
				console.log('사용자는 로그인 상태입니다.');

				document.querySelector(
					'.login',
				).innerHTML = `<li class='logout'>로그아웃</li>`;
				document.querySelector('.logout').onclick = function () {
					localStorage.clear();
					alert('로그아웃 되었습니다.');
				};
			}
		};
		loginCheck();

		function userName() {
			const token = localStorage.getItem('TOKEN');
			console.log(token);

			if (!token) {
				console.error('토큰이 없습니다');
				return;
			}

			fetch('http://localhost:3000/api/v1/users/profile?email=test@test.com', {
				headers: {
					Authorization: `Bearer ${token}`,
				},
			})
				.then((res) => res.json())
				.then((data) => {
					let name = document.createElement('strong');
					name.textContent = data.name;
					const userName = document.querySelector('.user-desc');
					userName.prepend(name);
				});
		}
		userName();

		function orderList() {
			fetch('http://localhost:3000/api/v1/orders/', {
				method: 'GET',
				headers: {
					Authorization: `Bearer ${token}`,
				},
			})
				.then((response) => response.json())
				.then((data) => console.log(data));
		}

		orderList();

		function logout() {
			if (!token) {
				console.error('토큰이 없습니다');
				return;
			}

			fetch('http://localhost:3000/api/v1/users/logout', {
				method: 'GET',
				headers: {
					Authorization: `Bearer ${token}`,
				},
			})
				.then((response) => response.json())
				.then((data) => {
					console.log(data);
					if (data.message === '로그인 성공') {
						alert('로그아웃 성공');
					}
				});
		}

		logout();
	</script>
</html>
